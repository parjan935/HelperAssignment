<mat-toolbar style="border: 1px solid rgb(206, 204, 204);">
  <div>Helpers</div>
</mat-toolbar>
<mat-toolbar>
  <div class="filtering">
    <div class="sorting">
      <button matButton [matMenuTriggerFor]="sorting">
        <mat-icon>swap_vert</mat-icon>
      </button>
      <mat-menu #sorting="matMenu">
        <span disabled>Sort by</span>
        <button mat-menu-item [style.backgroundColor]="sortFilter=='name'?'rgb(231, 230, 247)':''"
          (click)="sortHelpersBy('name')">Helpers Names(A-Z) <mat-icon
            [style.display]="sortFilter=='name'?'':'none'">check</mat-icon> </button>
        <button mat-menu-item [style.backgroundColor]="sortFilter=='employeeID'?'rgb(231, 230, 247)':''"
          (click)="sortHelpersBy('employeeID')">Employee ID <mat-icon
            [style.display]="sortFilter=='employeeID'?'':'none'">check</mat-icon>
        </button>
      </mat-menu>
    </div>

    <div class="filter-by-servOrg">
      <button (click)="togglePopup($event)">
        <mat-icon>filter_alt</mat-icon>
      </button>
      <div #filterPopup *ngIf="openFilter">
        <mat-card class="example-card">
          <mat-card-header style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <mat-icon style="align-self: flex-end; cursor: pointer;" (click)="openFilter=false">close</mat-icon>
            <mat-card-title>Filter</mat-card-title>
          </mat-card-header>
          <mat-card-content style="display: flex; flex-direction: column; font-size: small;">
            <label for="service">Type of Service*</label>

            <mat-form-field appearance="outline">
              <mat-select placeholder="Select Type of Service" [(ngModel)]="serviceFilter" multiple>
                <mat-option (click)="selectOrDeselectAll('service')"
                  [value]="'all'">{{serviceFilter.length===inputOptions.services.length?'Deselect
                  All':'Select All'}} </mat-option>
                <mat-option *ngFor="let s of inputOptions.services" [value]="s">{{s}}</mat-option>
              </mat-select>
            </mat-form-field>

            <label for="org">Organizatino Name*</label>
            <mat-form-field appearance="outline">
              <mat-select placeholder="Organizatino Name" [(ngModel)]="organizationFilter" multiple>
                <mat-option (click)="selectOrDeselectAll('organization')"
                  [value]="'all'">{{organizationFilter.length===inputOptions.orgs.length?'Deselect
                  All':'Select All'}} </mat-option>
                <mat-option *ngFor="let o of inputOptions.orgs" [value]="o">{{o}}</mat-option>
              </mat-select>
            </mat-form-field>

          </mat-card-content>
          <mat-card-actions>
            <button (click)="resetFilter()"> reset</button>
            <button (click)="applyFilter()">apply</button>
          </mat-card-actions>
        </mat-card>

      </div>
    </div>

    <div class="calendar">
      <input matInput [matDatepicker]="picker" (dateChange)="onDateChange($event)" [(ngModel)]="selectedDate" hidden>
      <mat-datepicker #picker></mat-datepicker>
      <button matButton (click)="picker.open()"> <mat-icon>event</mat-icon></button>
    </div>

    <div class="search">
      <mat-icon>search</mat-icon>
      <input type="search" placeholder="Search by name" [(ngModel)]="searchVal" (input)="handleSearchChange()"
        #searchInput>
    </div>
    <span style="font-size:small; color: gray;">{{filteredHelpers && filteredHelpers.length}} helpers</span>
  </div>
  <div class="save-add">
    <div class="save" (click)="saveAsExcel()">
      <mat-icon>download</mat-icon>
    </div>
    <button routerLink="add-helper">
      <mat-icon>add</mat-icon>
      <a style="color: white; text-decoration: none;">Add-helper</a>
    </button>
  </div>
</mat-toolbar>

<!-- /// Data  -->

<div class="example-container">
  <div class="mat-drawer" mode="side">
    <div *ngIf="!loadingHelpers else loading">

      @for(helper of filteredHelpers; track helper){
      <div class="helper" (click)="selectedHelper=helper"
        [ngStyle]="{'background-color':helper.name===selectedHelper.name ? 'rgb(231, 230, 247)':''}">
        <img [src]="helper.profilePic " alt="Profile Photo" alt="Prifile Photo"
          style="width: 50px; height: 50px; border-radius: 100%;">
        <div>
          <p>
            {{helper.name}}
          </p>
          <span>{{helper.service}}</span>
        </div>
      </div>
      }
      <div *ngIf="!loadingHelpers && filteredHelpers && filteredHelpers.length==0"
        style="text-align: center; padding-top: 40px;">
        <p>No helpers to display.</p>
        <p *ngIf="helpers.length==0">Click on Add Helper to add.</p>
      </div>
    </div>
    <ng-template #loading><mat-spinner style=" margin: auto; margin-top: 30px;"></mat-spinner></ng-template>
  </div>
  <div class="mat-drawer-content ">
    <div>
      <div *ngIf="selectedHelper!==undefined; else noHelpers" class="helper-details">
        <div style="display: flex; align-items: center; justify-content: space-between;">
          <div class="main-data">
            <img style="width: 100px; height: 100px; border-radius: 100%;" [src]="selectedHelper.profilePic "
              alt="Profile Photo" alt="Profile Photo" />
            <div>
              <p>{{ selectedHelper.name }}</p>
              <span style="color: rgb(143, 143, 143);">{{ selectedHelper.service }}</span>
            </div>
          </div>
          <div class="edit-delete-btns">
            <button routerLink="edit-helper/{{selectedHelper._id}}"><mat-icon>edit</mat-icon></button>
            <button (click)="deleteHelper()"> <mat-icon>delete</mat-icon></button>
          </div>
        </div>
        <div>
          <div style="display: flex; align-items: center; gap: 15px;">
            <h5 style="display: flex; width: fit-content; color: gray;">EMPLOYEE ID</h5>
            <span style="flex: 1; border: 0.5px solid rgb(234, 234, 234); height: 0;"></span>
          </div>
          <div class="other-data">
            <div>
              <span>Identification Card</span>
              <span>Employee Code</span>
            </div>
            <div>
              <span class="view-docx" (click)="openEmployeeIdDialog()">
                <mat-icon style="font-size: large; width: fit-content; height: fit-content;">visibility</mat-icon>
                view
              </span>
              <span>{{selectedHelper.employeeID}}</span>
            </div>
          </div>
        </div>
        <div>
          <div style="display: flex; align-items: center; gap: 15px;">
            <h5 style="display: flex; width: fit-content;  color: gray;">PERSONAL DETAILS</h5>
            <span style="flex: 1; border: 0.5px solid rgb(234, 234, 234); height: 0;"></span>
          </div>
          <div class="other-data">
            <div>
              <span>Gender</span>
              <span>Languages</span>
              <span>Mobile</span>
              <span>Email</span>
              <span>KYC Document</span>
            </div>
            <div>
              <span>{{ selectedHelper.gender }}</span>
              <span>{{ selectedHelper.languages }}</span>
              <span>{{ selectedHelper.phone }}</span>
              <span>{{ selectedHelper.email }}</span>
              <span class="view-docx" (click)="viewKycDocx()">
                <mat-icon style="font-size: large; width: fit-content; height: fit-content;">visibility</mat-icon>
                view
              </span>
            </div>
          </div>
        </div>
        <div>
          <div style="display: flex; align-items: center; gap: 15px;">
            <h5 style="display: flex; width: fit-content;  color: gray;">SERVICE DETAILS</h5>
            <span style="flex: 1; border: 0.5px solid rgb(234, 234, 234); height: 0;"></span>
          </div>
          <div class="other-data">
            <div>
              <span>Type</span>
              <span>Organization</span>
              <span>Joined On</span>
            </div>
            <div>
              <span>{{ selectedHelper.service }}</span>
              <span>{{ selectedHelper.organization }}</span>
              <span>{{selectedHelper.dateJoined | date: 'longDate'}}</span>
            </div>
          </div>
        </div>
      </div>
      <ng-template #noHelpers>
        <div style="display: flex; height: 100%; justify-content: center; padding-top: 40px;">
          <p>Select a helper to diaplay.</p>
        </div>
      </ng-template>
    </div>
  </div>
</div>